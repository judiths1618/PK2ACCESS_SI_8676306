'''--------plot gantt chart-------'''
import pandas as pd
import plotly.plotly as py
import plotly.figure_factory as ff
import datetime
vms = ['t3.medium','t3.large','c5.large','m5.large','c5n.large','r5a.large','a1.4xlarge']
DQN=[[4, 1, 0.0, 0.709555], [1, 6, 0.0, 0.597729], [1, 4, 0.0, 0.717017], [0, 1, 0.717017, 1.424064], [0, 2, 0.0, 0.611621], [2, 5, 0.0, 0.652174], [0, 7, 0.717017, 0.833858], [4, 7, 0.833858, 1.040527], [4, 2, 0.611621, 1.202172], [0, 7, 1.040527, 1.157368], [0, 7, 1.157368, 1.274209], [0, 7, 1.274209, 1.39105], [4, 1, 1.424064, 2.182406], [1, 3, 0.0, 0.662983], [1, 7, 1.39105, 1.5078909999999999], [4, 4, 0.717017, 1.378976], [0, 7, 1.5078909999999999, 1.5978329999999998], [0, 2, 1.202172, 1.792723], [0, 7, 1.5978329999999998, 1.7146739999999998], [0, 7, 1.7146739999999998, 1.8315149999999998], [2, 5, 0.652174, 1.304348], [1, 3, 0.662983, 1.325966], [0, 4, 1.378976, 2.040935], [2, 5, 1.304348, 1.956522], [4, 7, 1.8315149999999998, 1.9614469999999997], [0, 7, 1.9614469999999997, 2.0782879999999997], [0, 1, 2.182406, 2.8894529999999996], [1, 7, 2.0782879999999997, 2.1951289999999997], [1, 2, 1.792723, 2.4571750000000003], [2, 4, 2.040935, 2.7579520000000004], [2, 1, 2.8894529999999996, 3.600859], [1, 7, 2.1951289999999997, 2.3119699999999996], [2, 2, 2.4571750000000003, 3.121627], [0, 7, 2.3119699999999996, 2.4288109999999996], [0, 7, 2.7579520000000004, 2.8747930000000004], [1, 7, 2.8747930000000004, 2.9916340000000003], [2, 7, 2.9916340000000003, 3.1084750000000003], [2, 7, 3.1084750000000003, 3.2253160000000003], [1, 7, 3.2253160000000003, 3.3421570000000003], [1, 7, 3.3421570000000003, 3.4589980000000002], [0, 4, 2.7579520000000004, 3.4261030000000003], [4, 3, 1.325966, 1.933746], [0, 5, 1.956522, 2.560508], [2, 2, 3.121627, 3.733248], [4, 6, 0.597729, 1.2599809999999998], [0, 6, 1.2599809999999998, 1.8577099999999998], [0, 7, 3.733248, 3.850089], [2, 1, 3.600859, 4.307906], [0, 7, 3.850089, 3.96693], [0, 7, 3.96693, 4.0837710000000005], [2, 4, 3.4261030000000003, 4.094254], [0, 7, 4.0837710000000005, 4.173713], [4, 3, 1.933746, 2.541526], [0, 4, 4.094254, 4.7355540000000005], [1, 2, 3.733248, 4.344869], [2, 7, 4.173713, 4.290554], [0, 1, 4.307906, 5.014953], [0, 7, 4.290554, 4.420486], [1, 7, 4.420486, 4.537327], [3, 3, 2.541526, 3.2045090000000003], [1, 7, 4.537327, 4.654168], [2, 7, 4.654168, 4.915287], [2, 3, 3.2045090000000003, 3.8306830000000005], [3, 5, 2.560508, 3.164494], [3, 5, 3.164494, 3.76848], [3, 3, 3.8306830000000005, 4.373571], [2, 2, 4.344869, 4.9018690000000005], [2, 5, 3.76848, 4.354189], [2, 6, 1.8577099999999998, 2.5199619999999996], [3, 7, 4.915287, 5.032128], [1, 1, 5.014953, 5.724508], [0, 7, 5.032128, 5.148969], [3, 7, 5.148969, 5.238911], [2, 7, 5.238911, 5.44558], [3, 7, 5.44558, 5.535521999999999], [3, 7, 5.535521999999999, 5.652362999999999], [2, 3, 4.373571, 4.954854], [2, 3, 4.954854, 5.536137], [2, 5, 4.354189, 4.958175], [3, 7, 5.652362999999999, 5.769203999999999], [0, 2, 5.014953, 5.679405], [2, 3, 5.536137, 6.11742], [3, 1, 5.724508, 6.434063], [0, 7, 5.769203999999999, 6.030322999999999], [3, 7, 6.030322999999999, 6.120264999999999], [2, 7, 6.120264999999999, 6.237105999999999], [2, 7, 6.237105999999999, 6.443774999999999], [3, 3, 6.11742, 6.698703], [3, 5, 4.958175, 5.560343], [2, 5, 5.560343, 6.1643289999999995], [3, 1, 6.434063, 7.192405], [1, 7, 6.443774999999999, 6.6504439999999985], [2, 7, 6.6504439999999985, 6.767284999999998], [1, 7, 6.767284999999998, 6.897216999999999], [4, 7, 6.897216999999999, 7.103885999999998], [3, 2, 5.679405, 6.2699560000000005], [4, 3, 6.698703, 7.306483], [2, 5, 6.1643289999999995, 6.768314999999999], [1, 2, 6.2699560000000005, 6.885341], [1, 4, 4.7355540000000005, 5.397513], [3, 4, 5.397513, 6.038813], [1, 2, 6.885341, 7.500726], [3, 6, 2.5199619999999996, 3.2893899999999996], [1, 4, 6.038813, 6.700772000000001], [2, 7, 7.103885999999998, 7.220726999999998], [3, 1, 7.192405, 8.040581], [0, 7, 7.220726999999998, 7.310668999999998], [2, 7, 7.310668999999998, 7.427509999999998], [1, 2, 7.500726, 8.165178000000001], [1, 7, 7.427509999999998, 7.544350999999998], [2, 7, 7.544350999999998, 7.634292999999998], [3, 7, 7.634292999999998, 7.8409619999999975], [3, 4, 6.700772000000001, 7.362731], [3, 4, 7.362731, 8.02469], [3, 2, 8.165178000000001, 8.829630000000002], [3, 7, 7.8409619999999975, 7.9578029999999975], [3, 7, 7.9578029999999975, 8.047744999999997], [1, 1, 8.040581, 8.750136], [1, 7, 8.047744999999997, 8.254413999999997], [4, 7, 8.254413999999997, 8.344355999999998], [4, 5, 6.768314999999999, 7.354023999999999], [4, 7, 8.344355999999998, 8.551024999999997], [4, 4, 8.02469, 8.665989999999999], [4, 7, 8.551024999999997, 8.680956999999998], [4, 4, 8.665989999999999, 9.327948999999998], [4, 1, 8.750136, 9.508478], [4, 7, 8.680956999999998, 8.887625999999997], [4, 2, 8.829630000000002, 9.445015000000001], [4, 7, 8.887625999999997, 9.017557999999998], [4, 7, 9.017557999999998, 9.224226999999997], [4, 7, 9.224226999999997, 9.354158999999997], [4, 7, 9.354158999999997, 9.560827999999997], [4, 4, 9.327948999999998, 9.989907999999998], [4, 3, 7.306483, 7.914263], [4, 1, 9.508478, 10.266820000000001], [4, 7, 9.560827999999997, 9.677668999999998], [4, 7, 9.677668999999998, 9.807600999999998], [4, 2, 9.445015000000001, 10.109467000000002]]


num_job = 5  # number of jobs
num_mc = 7  # number of machines
m_keys = [j + 1 for j in range (num_mc)]
j_keys = [j for j in range (num_job)]
df = []

DQN_record=[]
for k in DQN:
    start_time = str(datetime.timedelta(seconds=k[2]*10))
    end_time=str(datetime.timedelta(seconds=k[3]*10))
    DQN_record.append((k[0], k[1], [start_time, end_time]))
print(len(DQN_record))

for m in m_keys:
    for j in j_keys:
        for i in DQN_record:
            if (m, j) == (i[1], i[0]):
                # print (i[2], m, j)
                # df.append (dict (Task='Machine %s' % (m), Start='2018-12-22 %s' % (str (i[2][0])),
                #          Finish='2018-12-22 %s' % (str (i[2][1])), Resource='Workflow %s' % (j + 1)))
                df.append (dict (Task=vms[m - 1], Start='2018-12-22 %s' % (str (i[2][0])),
                             Finish='2018-12-22 %s' % (str (i[2][1])), Resource='Workflow %s' % (j + 1)))
fig = ff.create_gantt (df, index_col='Resource', show_colorbar=True, group_tasks=True, showgrid_x=True,
                       title='Workflow Schedule')
py.plot (fig, filename='DQN_workflow_scheduling', world_readable=True)
